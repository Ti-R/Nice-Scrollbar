if(_.isUndefined(TR)){var TR={}}TR.DebugScroll=false;TR.ScrollMouse={x:0,y:0};TR.TouchMouse={y:0};document.addEventListener("mousemove",function(a){TR.ScrollMouse.x=a.clientX||a.pageX;TR.ScrollMouse.y=a.clientY||a.pageY},false);TR.NiceScroll=function(d,c){this.mOptions={};this.mOptions.ScrollInnerSizeMin=20;this.mOptions.ForceScrollingMax=5;this.mOptions.EnableForceScrolling=true;this.mIdChild=d;this.mInterval=undefined;this.mForceScrollingCount=0;var b=this;function a(e,f){if(_.has(c,f)){b.mOptions[f]=c[f]}}_.each(this.mOptions,a)};TR.NiceScroll.prototype.Remove=function(){var d=$(this.mIdChild);var c=d.parent();var b=c.parent();if(!b.hasClass("NodeNiceScroll")){return}c.insertBefore(b);b.remove();if(this.mInterval!=undefined){window.clearInterval(this.mInterval);this.mInterval=undefined}c.css("overflow","auto");var a=c.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.remove();d.unbind("mousewheel.tr_scroll");d.unbind("touchstart.tr_scroll");d.unbind("touchmove.tr_scroll")};TR.NiceScroll.prototype.Add=function(){this.Remove();var h=$(this.mIdChild);var f=h.parent();var j='<div class="NodeNiceScroll" style="position:relative;"></div>';$(j).insertBefore(f);f.prev().append(f);if(TR.DebugScroll){if(h.length){console.log("TR.NiceScroll.Add -> "+this.mIdChild+" is found and attached")}else{console.log("ERROR: TR.NiceScroll.Add -> "+this.mIdChild+" is NOT found")}}function e(k){return a((k.deltaY*200),true,false)}h.unbind("mousewheel.tr_scroll").bind("mousewheel.tr_scroll",function(k){if(e(k)){return false}return true});h.unbind("touchstart.tr_scroll").children().bind("touchstart.tr_scroll",function(l){if(TR.DebugScroll){console.log("touchstart.tr_scroll")}TR.TouchMouse.y=l.originalEvent.changedTouches[0].pageY;$(this).unbind("touchmove.tr_scroll").bind("touchmove.tr_scroll",function(m){m.preventDefault();if(TR.DebugScroll){console.log("touchmove",m.originalEvent.changedTouches[0].pageY-TR.TouchMouse.y+" px")}a((m.originalEvent.changedTouches[0].pageY-TR.TouchMouse.y),false,false);TR.TouchMouse.y=m.originalEvent.changedTouches[0].pageY});function k(){$(this).unbind("touchend.tr_scroll").unbind("touchcancel.tr_scroll")}$(this).unbind("touchend.tr_scroll").bind("touchend.tr_scroll",function(m){if(TR.DebugScroll){console.log("touchend")}_.bind(k,this)()});$(this).unbind("touchcancel.tr_scroll").bind("touchcancel.tr_scroll",function(m){if(TR.DebugScroll){console.log("touchcancel")}_.bind(k,this)()})});var c=this;function a(t,o,v){var r=f.innerHeight();var l=h.outerHeight();var u=f.prev();if(!u){return}if(!u.hasClass("tr_scrollbar")){return}var p=u.find(".tr_scrollbar_inner");var q=f.scrollTop();if(TR.DebugScroll){console.log("_pixels:",t);console.log("tParentHeight:",r);console.log("tChildHeight:",l);console.log("tChildHeight-tParentHeight:",l-r)}var n=((r)-((r/l)*r));if(n+c.mOptions.ScrollInnerSizeMin>r){n=r-c.mOptions.ScrollInnerSizeMin}if(o){if(v){var s=-p.position().top;var k=(-s)-t;if(TR.DebugScroll){console.log("tScrollBarInnerPositionTop:",s)}if(k<0){k=0}else{if(k>n){k=n}}p.css({top:k+"px"});var m=k/n*(l-r);f.scrollTop(m)}else{var s=-f.scrollTop();var k=(-s)-t;if(TR.DebugScroll){console.log("tScrollBarInnerPositionTop:",s)}if(k<0){k=0}else{if(k>(l-r)){k=(l-r)}}f.stop().animate({scrollTop:k},100,"linear");var m=k/(l-r)*n;p.stop().animate({top:m},100,"linear")}}else{var s=-f.scrollTop();var k=(-s)-t;if(TR.DebugScroll){console.log("tScrollBarInnerPositionTop:",s)}if(k<0){k=0}else{if(k>(l-r)){k=(l-r)}}f.scrollTop(k);var m=k/(l-r)*n;p.css({top:m+"px"})}if(q===f.scrollTop()){if(c.mOptions.EnableForceScrolling){++c.mForceScrollingCount;if(c.mForceScrollingCount>c.mOptions.ForceScrollingMax){c.mForceScrollingCount=0;return false}}return true}c.mForceScrollingCount=0;return true}var g=this.mIdChild;function i(){var u=f.prev();if(u&&u.hasClass("tr_scrollbar")){u.remove()}f.css("overflow","hidden");var p=f.innerHeight();var s=0;var k=h.outerHeight();if(p<k){s+=parseFloat(f.css("border-top-width"));var t="";t+='<div class="tr_scrollbar tr_scrollbar_invible" style="height:'+p+"px;margin-top:"+s+'px" onmouseover="TR.SetScrollBarBigger(\''+g+"')\" onmouseout=\"TR.SetScrollBarSmaller('"+g+"')\">";t+='<div class="tr_scrollbar_background" style="height:'+p+'px;">';t+='<div class="tr_scrollbar_inner" style="height:'+(p/k)*100+'%">';t+="</div>";t+="</div>";t+="</div>";$(t).insertBefore(f);var q=false;var l=TR.ScrollMouse.y;var u=f.prev();if(!u){return}if(!u.hasClass("tr_scrollbar")){return}var o=u.find(".tr_scrollbar_inner");var r=0;var m=u.children(".tr_scrollbar_background");if(o.height()<c.mOptions.ScrollInnerSizeMin){o.height(c.mOptions.ScrollInnerSizeMin)}u.css({"margin-left":(f.outerWidth()-parseFloat(f.css("border-left-width"))-parseFloat(f.css("border-right-width"))+parseFloat(f.css("margin-left"))-30)+"px"});var n=0;a(0,true,false);m.click(function(x){if(TR.ScrollMouse.y<o.offset().top){a(m.height()*0.8,false,true)}else{a(-m.height()*0.8,false,true)}return false});u.mousewheel(function(x){e(x);return false});o.mousedown(function(){n=1;l=TR.ScrollMouse.y;r=o.position().top;q=true;$("body").append('<div class="tr_scrollbar_scrolling_dontloose_focus tr_scrollbar_invible"></div>');$(".tr_scrollbar_scrolling_dontloose_focus").css("position","fixed").css("top",(u.offset().top-200)+"px").css("left",u.offset().left-200+"px").css("height",(p+400)+"px").css("width","440px");$("body").addClass("tr_forbid_selection");$(".tr_scrollbar_scrolling_dontloose_focus").mouseup(function(){w()}).mouseleave(function(){w()}).mousemove(function(){if(q){v();TR.SetScrollBarBigger(g,true)}l=TR.ScrollMouse.y})});function w(){q=false;$(".tr_scrollbar_scrolling_dontloose_focus").remove();$("body").removeClass("tr_forbid_selection");TR.SetScrollBarSmaller(g)}function v(){a(l-TR.ScrollMouse.y,true,true)}}}var b=-1;var d=-1;this.mInterval=setInterval(function(){if((b!=h.width())||(d!=h.innerHeight())){b=h.width();d=h.innerHeight();i()}},500);i()};TR.SetScrollBarBigger=function(d,b){b=b||false;var e=$(d);var c=e.parent();var a=c.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.find(".tr_scrollbar_background").addClass("tr_scrollbar_width_hover");a.find(".tr_scrollbar_inner").addClass("tr_scrollbar_width_hover");if(b){a.find(".tr_scrollbar_inner").addClass("tr_scrollbar_inner_hover")}};TR.SetScrollBarSmaller=function(c){var d=$(c);var b=d.parent();var a=b.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.find(".tr_scrollbar_background").removeClass("tr_scrollbar_width_hover");a.find(".tr_scrollbar_inner").removeClass("tr_scrollbar_width_hover").removeClass("tr_scrollbar_inner_hover")};