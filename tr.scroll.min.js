// Author: Ti-R (Renan Lavarec)
// License: MIT
// Version: 1.2.0
var gDebugScroll=false;var gScrollMouse={x:0,y:0};var gTouchMouse={y:0};document.addEventListener("mousemove",function(a){gScrollMouse.x=a.clientX||a.pageX;gScrollMouse.y=a.clientY||a.pageY},false);if(_.isUndefined(TR)){var TR={}}TR.NiceScroll=function(a){this.mIdChild=a;this.mInterval=undefined};TR.NiceScroll.prototype.Remove=function(){var c=$(this.mIdChild);var b=c.parent();if(this.mInterval!=undefined){window.clearInterval(this.mInterval);this.mInterval=undefined}var a=b.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.remove();c.unbind("mousewheel");c.unbind("touchstart");c.unbind("touchmove")};TR.NiceScroll.prototype.Add=function(){this.Remove();var h=$(this.mIdChild);var e=h.parent();if(gDebugScroll){if(h.length){console.log("TR.NiceScroll.Add -> "+this.mIdChild+" is found and attached")}else{console.log("ERROR: TR.NiceScroll.Add -> "+this.mIdChild+" is NOT found")}}function a(i){d((i.deltaY*200),true,false)}h.unbind("mousewheel").mousewheel(function(i){a(i);return false});h.unbind("touchstart").children().bind("touchstart",function(j){if(gDebugScroll){console.log("touchstart")}gTouchMouse.y=j.originalEvent.changedTouches[0].pageY;$(this).unbind("touchmove").bind("touchmove",function(k){k.preventDefault();if(gDebugScroll){console.log("touchmove ",k.originalEvent.changedTouches[0].pageY-gTouchMouse.y+" px")}d((k.originalEvent.changedTouches[0].pageY-gTouchMouse.y),false,false);gTouchMouse.y=k.originalEvent.changedTouches[0].pageY});function i(){$(this).unbind("touchend").unbind("touchcancel")}$(this).unbind("touchend").bind("touchend",function(k){if(gDebugScroll){console.log("touchend")}_.bind(i,this)()});$(this).unbind("touchcancel ").bind("touchcancel ",function(k){if(gDebugScroll){console.log("touchcancel")}_.bind(i,this)()})});function d(q,m,s){var o=e.innerHeight();var j=h.outerHeight();var r=e.prev();if(!r){return}if(!r.hasClass("tr_scrollbar")){return}var n=r.find(".tr_scrollbar_inner");if(gDebugScroll){console.log("_pixels:",q);console.log("tParentHeight:",o);console.log("tChildHeight:",j);console.log("tChildHeight-tParentHeight:",j-o)}var l=((o)-((o/j)*o));if(m){if(s){var p=-n.position().top;var i=(-p)-q;if(gDebugScroll){console.log("tScrollBarInnerPositionTop:",p)}if(i<0){i=0}else{if(i>l){i=l}}n.css({top:i+"px"});var k=i/l*(j-o);e.scrollTop(k)}else{var p=-e.scrollTop();var i=(-p)-q;if(gDebugScroll){console.log("tScrollBarInnerPositionTop:",p)}if(i<0){i=0}else{if(i>(j-o)){i=(j-o)}}e.stop().animate({scrollTop:i},100,"linear");var k=i/(j-o)*l;n.stop().animate({top:k},100,"linear")}}else{var p=-e.scrollTop();var i=(-p)-q;if(gDebugScroll){console.log("tScrollBarInnerPositionTop:",p)}if(i<0){i=0}else{if(i>(j-o)){i=(j-o)}}e.scrollTop(i);var k=i/(j-o)*l;n.css({top:k+"px"})}}var b=this.mIdChild;function f(){var s=e.prev();if(s&&s.hasClass("tr_scrollbar")){s.remove()}e.css("overflow","hidden");var n=e.innerHeight();var q=0;var i=h.outerHeight();if(n<i){q+=parseFloat(e.css("border-top-width"));var r="";r+='<div class="tr_scrollbar tr_scrollbar_invible" style="height:'+n+"px;margin-top:"+q+'px" onmouseover="TR.SetScrollBarBigger(\''+b+"')\" onmouseout=\"TR.SetScrollBarSmaller('"+b+"')\">";r+='<div class="tr_scrollbar_background" style="height:'+n+'px;">';r+='<div class="tr_scrollbar_inner" style="height:'+(n/i)*100+'%">';r+="</div>";r+="</div>";r+="</div>";$(r).insertBefore(e);var o=false;var j=gScrollMouse.y;var s=e.prev();if(!s){return}if(!s.hasClass("tr_scrollbar")){return}var m=s.find(".tr_scrollbar_inner");var p=0;var k=s.children(".tr_scrollbar_background");s.css({"margin-left":(e.outerWidth()-parseFloat(e.css("border-left-width"))-parseFloat(e.css("border-right-width"))+parseFloat(e.css("margin-left"))-30)+"px"});var l=0;d(0,true,false);k.click(function(v){if(gScrollMouse.y<m.offset().top){d(k.height()*0.8,false,true)}else{d(-k.height()*0.8,false,true)}return false});s.mousewheel(function(v){a(v);return false});m.mousedown(function(){l=1;j=gScrollMouse.y;p=m.position().top;o=true;$("body").append('<div class="tr_scrollbar_scrolling_dontloose_focus tr_scrollbar_invible"></div>');$(".tr_scrollbar_scrolling_dontloose_focus").css("position","fixed").css("top",(s.offset().top-200)+"px").css("left",s.offset().left-200+"px").css("height",(n+400)+"px").css("width","440px");$("body").addClass("tr_forbid_selection");$(".tr_scrollbar_scrolling_dontloose_focus").mouseup(function(){u()}).mouseleave(function(){u()}).mousemove(function(){if(o){t();TR.SetScrollBarBigger(b,true)}j=gScrollMouse.y})});function u(){o=false;$(".tr_scrollbar_scrolling_dontloose_focus").remove();$("body").removeClass("tr_forbid_selection");TR.SetScrollBarSmaller(b)}function t(){d(j-gScrollMouse.y,true,true)}}}var g=-1;var c=-1;this.mInterval=setInterval(function(){if((g!=h.width())||(c!=h.innerHeight())){g=h.width();c=h.innerHeight();f()}},500);f()};TR.SetScrollBarBigger=function(d,b){b=b||false;var e=$(d);var c=e.parent();var a=c.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.find(".tr_scrollbar_background").addClass("tr_scrollbar_width_hover");a.find(".tr_scrollbar_inner").addClass("tr_scrollbar_width_hover");if(b){a.find(".tr_scrollbar_inner").addClass("tr_scrollbar_inner_hover")}};TR.SetScrollBarSmaller=function(c){var d=$(c);var b=d.parent();var a=b.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.find(".tr_scrollbar_background").removeClass("tr_scrollbar_width_hover");a.find(".tr_scrollbar_inner").removeClass("tr_scrollbar_width_hover").removeClass("tr_scrollbar_inner_hover")};