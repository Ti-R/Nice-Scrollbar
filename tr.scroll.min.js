if(_.isUndefined(TR)){var TR={}}TR.DebugScroll=false;TR.ScrollMouse={x:0,y:0};TR.TouchMouse={y:0};document.addEventListener("mousemove",function(a){TR.ScrollMouse.x=a.clientX||a.pageX;TR.ScrollMouse.y=a.clientY||a.pageY},false);TR.NiceScroll=function(d,c){this.mOptions={};this.mOptions.ScrollInnerSizeMin=20;this.mOptions.ForceScrollingMax=5;this.mOptions.EnableForceScrolling=true;this.mIdChild=d;this.mInterval=undefined;this.mForceScrollingCount=0;if(c){var b=this;function a(e,f){if(_.has(c,f)){b.mOptions[f]=c[f]}}_.each(this.mOptions,a)}};TR.NiceScroll.prototype.Remove=function(){var d=$(this.mIdChild);var c=d.parent();var b=c.parent();if(!b.hasClass("NodeNiceScroll")){return}c.insertBefore(b);b.remove();if(this.mInterval!=undefined){window.clearInterval(this.mInterval);this.mInterval=undefined}c.css("overflow","auto");var a=c.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.remove();d.unbind("mousewheel.tr_scroll");d.unbind("touchstart.tr_scroll");d.unbind("touchmove.tr_scroll")};TR.NiceScroll.prototype.Add=function(){this.Remove();var i=$(this.mIdChild);var f=i.parent();var k='<div class="NodeNiceScroll" style="position:relative;"></div>';$(k).insertBefore(f);f.prev().append(f);if(TR.DebugScroll){if(i.length){console.log("TR.NiceScroll.Add -> "+this.mIdChild+" is found and attached")}else{console.log("ERROR: TR.NiceScroll.Add -> "+this.mIdChild+" is NOT found")}}function e(l){return a((l.deltaY*200),true,false)}i.unbind("mousewheel.tr_scroll").bind("mousewheel.tr_scroll",function(l){if(e(l)){return false}return true});i.unbind("touchstart.tr_scroll").children().bind("touchstart.tr_scroll",function(m){if(TR.DebugScroll){console.log("touchstart.tr_scroll")}TR.TouchMouse.y=m.originalEvent.changedTouches[0].pageY;$(this).unbind("touchmove.tr_scroll").bind("touchmove.tr_scroll",function(n){n.preventDefault();if(TR.DebugScroll){console.log("touchmove",n.originalEvent.changedTouches[0].pageY-TR.TouchMouse.y+" px")}a((n.originalEvent.changedTouches[0].pageY-TR.TouchMouse.y),false,false);TR.TouchMouse.y=n.originalEvent.changedTouches[0].pageY});function l(){$(this).unbind("touchend.tr_scroll").unbind("touchcancel.tr_scroll")}$(this).unbind("touchend.tr_scroll").bind("touchend.tr_scroll",function(n){if(TR.DebugScroll){console.log("touchend")}_.bind(l,this)()});$(this).unbind("touchcancel.tr_scroll").bind("touchcancel.tr_scroll",function(n){if(TR.DebugScroll){console.log("touchcancel")}_.bind(l,this)()})});var c=this;function a(u,p,w){var s=f.innerHeight();var m=i.outerHeight();var v=f.prev();if(!v){return}if(!v.hasClass("tr_scrollbar")){return}var q=v.find(".tr_scrollbar_inner");var r=f.scrollTop();if(TR.DebugScroll){console.log("_pixels:",u);console.log("tParentHeight:",s);console.log("tChildHeight:",m);console.log("tChildHeight-tParentHeight:",m-s)}var o=((s)-((s/m)*s));if(o+c.mOptions.ScrollInnerSizeMin>s){o=s-c.mOptions.ScrollInnerSizeMin}if(p){if(w){var t=-q.position().top;var l=(-t)-u;if(TR.DebugScroll){console.log("tScrollBarInnerPositionTop:",t)}if(l<0){l=0}else{if(l>o){l=o}}q.css({top:l+"px"});var n=l/o*(m-s);f.scrollTop(n)}else{var t=-f.scrollTop();var l=(-t)-u;if(TR.DebugScroll){console.log("tScrollBarInnerPositionTop:",t)}if(l<0){l=0}else{if(l>(m-s)){l=(m-s)}}f.stop().animate({scrollTop:l},100,"linear");var n=l/(m-s)*o;q.stop().animate({top:n},100,"linear")}}else{var t=-f.scrollTop();var l=(-t)-u;if(TR.DebugScroll){console.log("tScrollBarInnerPositionTop:",t)}if(l<0){l=0}else{if(l>(m-s)){l=(m-s)}}f.scrollTop(l);var n=l/(m-s)*o;q.css({top:n+"px"})}if(r===f.scrollTop()){if(c.mOptions.EnableForceScrolling){++c.mForceScrollingCount;if(c.mForceScrollingCount>c.mOptions.ForceScrollingMax){c.mForceScrollingCount=0;return false}}return true}c.mForceScrollingCount=0;return true}var g=this.mIdChild;function j(){var v=f.prev();if(v&&v.hasClass("tr_scrollbar")){v.remove()}f.css("overflow","hidden");var q=f.innerHeight();var t=0;var l=i.outerHeight();if(q<l){t+=parseFloat(f.css("border-top-width"));var u="";u+='<div class="tr_scrollbar tr_scrollbar_invible" style="height:'+q+"px;margin-top:"+t+'px" onmouseover="TR.SetScrollBarBigger(\''+g+"')\" onmouseout=\"TR.SetScrollBarSmaller('"+g+"')\">";u+='<div class="tr_scrollbar_background" style="height:'+q+'px;">';u+='<div class="tr_scrollbar_inner" style="height:'+(q/l)*100+'%">';u+="</div>";u+="</div>";u+="</div>";$(u).insertBefore(f);var r=false;var m=TR.ScrollMouse.y;var v=f.prev();if(!v){return}if(!v.hasClass("tr_scrollbar")){return}var p=v.find(".tr_scrollbar_inner");var s=0;var n=v.children(".tr_scrollbar_background");if(p.height()<c.mOptions.ScrollInnerSizeMin){p.height(c.mOptions.ScrollInnerSizeMin)}v.css({"margin-left":(f.outerWidth()-parseFloat(f.css("border-left-width"))-parseFloat(f.css("border-right-width"))+parseFloat(f.css("margin-left"))-30)+"px"});var o=0;a(0,true,false);n.click(function(y){if(TR.ScrollMouse.y<p.offset().top){a(n.height()*0.8,false,true)}else{a(-n.height()*0.8,false,true)}return false});v.mousewheel(function(y){e(y);return false});p.mousedown(function(){o=1;m=TR.ScrollMouse.y;s=p.position().top;r=true;$("body").append('<div class="tr_scrollbar_scrolling_dontloose_focus tr_scrollbar_invible"></div>');$(".tr_scrollbar_scrolling_dontloose_focus").css("position","fixed").css("top",(v.offset().top-200)+"px").css("left",v.offset().left-200+"px").css("height",(q+400)+"px").css("width","440px");$("body").addClass("tr_forbid_selection");$(".tr_scrollbar_scrolling_dontloose_focus").mouseup(function(){x()}).mouseleave(function(){x()}).mousemove(function(){if(r){w();TR.SetScrollBarBigger(g,true)}m=TR.ScrollMouse.y})});function x(){r=false;$(".tr_scrollbar_scrolling_dontloose_focus").remove();$("body").removeClass("tr_forbid_selection");TR.SetScrollBarSmaller(g)}function w(){a(m-TR.ScrollMouse.y,true,true)}}}var b=-1;var d=-1;var h=-1;this.mInterval=setInterval(function(){if((b!=i.width())||(d!=i.innerHeight())||(h!=f.innerHeight())){b=i.width();d=i.innerHeight();h=f.innerHeight();j()}},500);j()};TR.SetScrollBarBigger=function(d,b){b=b||false;var e=$(d);var c=e.parent();var a=c.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.find(".tr_scrollbar_background").addClass("tr_scrollbar_width_hover");a.find(".tr_scrollbar_inner").addClass("tr_scrollbar_width_hover");if(b){a.find(".tr_scrollbar_inner").addClass("tr_scrollbar_inner_hover")}};TR.SetScrollBarSmaller=function(c){var d=$(c);var b=d.parent();var a=b.prev();if(!a){return}if(!a.hasClass("tr_scrollbar")){return}a.find(".tr_scrollbar_background").removeClass("tr_scrollbar_width_hover");a.find(".tr_scrollbar_inner").removeClass("tr_scrollbar_width_hover").removeClass("tr_scrollbar_inner_hover")};